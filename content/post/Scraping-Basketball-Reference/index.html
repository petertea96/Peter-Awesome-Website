---
authors:
- admin
categories:
- Demo
date: "2019-12-01T00:00:00Z"
draft: false
featured: false
image:
  caption: 'Image credit: [**Unsplash**](https://www.google.com/url?sa=i&rct=j&q=&esrc=s&source=images&cd=&ved=2ahUKEwiOn6jIg47mAhXEu54KHQ6IBMEQjRx6BAgBEAQ&url=https%3A%2F%2Ftwitter.com%2Fbball_ref%2Fstatus%2F1134290033979121664&psig=AOvVaw1RrNasfgvMlnI4e_gkKVMD&ust=1575069020292235)'
  focal_point: ""
  placement: 2
  preview_only: false
lastmod: "2019-04-17T00:00:00Z"
projects: []
subtitle: 'Exporting data online and into R in under 10 minutes :basketball: :fire:'
summary: Scrape Baksetball-Reference tables in under 10 minutes.
tags:
- Academic
- R
- Demo
- Web Scraping
title: 'Scraping data from Basketball-Reference'
geometry: margin = 1.75 cm
---



<div id="lets-ball" class="section level2">
<h2>Let’s Ball</h2>
<p>First, let’s load in two R packages:</p>
<ul>
<li>rvest:</li>
<li>dplyr:</li>
</ul>
<pre class="r"><code>#install.packages(&quot;rvest&quot;)
library(rvest)
library(dplyr)</code></pre>
<pre class="r"><code>my_url &lt;- read_html(&quot;https://www.basketball-reference.com/leagues/NBA_2020_per_game.html&quot;)
node &lt;- &quot;#per_game_stats a , .right , .center&quot;</code></pre>
<p>Let’s look at the first 30 elements of our compiled list:</p>
<pre class="r"><code>scraped_data &lt;- my_url %&gt;%
  html_nodes(node) %&gt;%
  html_text()

my_variable_names &lt;- scraped_data[1:30]

print(my_variable_names)</code></pre>
<pre><code>##  [1] &quot;Rk&quot;     &quot;Player&quot; &quot;Pos&quot;    &quot;Age&quot;    &quot;Tm&quot;     &quot;G&quot;      &quot;GS&quot;     &quot;MP&quot;    
##  [9] &quot;FG&quot;     &quot;FGA&quot;    &quot;FG%&quot;    &quot;3P&quot;     &quot;3PA&quot;    &quot;3P%&quot;    &quot;2P&quot;     &quot;2PA&quot;   
## [17] &quot;2P%&quot;    &quot;eFG%&quot;   &quot;FT&quot;     &quot;FTA&quot;    &quot;FT%&quot;    &quot;ORB&quot;    &quot;DRB&quot;    &quot;TRB&quot;   
## [25] &quot;AST&quot;    &quot;STL&quot;    &quot;BLK&quot;    &quot;TOV&quot;    &quot;PF&quot;     &quot;PTS&quot;</code></pre>
<p>Just an FYI, the data is saved as a <code>vector</code> in r, with <code>14,341</code> entries.</p>
<pre class="r"><code>is.vector(scraped_data)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>length(scraped_data)</code></pre>
<pre><code>## [1] 14341</code></pre>
<p>Some of the variable names begin with numbers. This is a huge no-no in R, so let’s manually change these names:</p>
<pre class="r"><code>my_variable_names[12:17] &lt;- c(&quot;Threes_made&quot;, &quot;Threes_attempted&quot;,
                              &quot;Threes_percent&quot;, &quot;Twos_made&quot;,
                              &quot;Twos_attempted&quot;, &quot;Twos_percent&quot;)</code></pre>
<p>We will use this vector data to fill in an empty table we create in R. We have to note though, that due to the way we’ve scraped the data there exists some garbage we must remove. I’ll illustrate below:</p>
<pre class="r"><code>scraped_data[600: 660]</code></pre>
<pre><code>##  [1] &quot;7.9&quot;           &quot;20&quot;            &quot;Marvin Bagley&quot; &quot;PF&quot;           
##  [5] &quot;20&quot;            &quot;SAC&quot;           &quot;1&quot;             &quot;1&quot;            
##  [9] &quot;28.0&quot;          &quot;6.0&quot;           &quot;16.0&quot;          &quot;.375&quot;         
## [13] &quot;0.0&quot;           &quot;0.0&quot;           &quot;&quot;              &quot;6.0&quot;          
## [17] &quot;16.0&quot;          &quot;.375&quot;          &quot;.375&quot;          &quot;2.0&quot;          
## [21] &quot;4.0&quot;           &quot;.500&quot;          &quot;4.0&quot;           &quot;6.0&quot;          
## [25] &quot;10.0&quot;          &quot;0.0&quot;           &quot;1.0&quot;           &quot;1.0&quot;          
## [29] &quot;1.0&quot;           &quot;1.0&quot;           &quot;14.0&quot;          &quot;Rk&quot;           
## [33] &quot;Player&quot;        &quot;Pos&quot;           &quot;Age&quot;           &quot;Tm&quot;           
## [37] &quot;G&quot;             &quot;GS&quot;            &quot;MP&quot;            &quot;FG&quot;           
## [41] &quot;FGA&quot;           &quot;FG%&quot;           &quot;3P&quot;            &quot;3PA&quot;          
## [45] &quot;3P%&quot;           &quot;2P&quot;            &quot;2PA&quot;           &quot;2P%&quot;          
## [49] &quot;eFG%&quot;          &quot;FT&quot;            &quot;FTA&quot;           &quot;FT%&quot;          
## [53] &quot;ORB&quot;           &quot;DRB&quot;           &quot;TRB&quot;           &quot;AST&quot;          
## [57] &quot;STL&quot;           &quot;BLK&quot;           &quot;TOV&quot;           &quot;PF&quot;           
## [61] &quot;PTS&quot;</code></pre>
<pre class="r"><code>to_remove &lt;- 631:660
n &lt;- length(scraped_data)

while(to_remove[length(to_remove)] &lt;= n - 601 ){
  
  A &lt;- to_remove[length(to_remove)] + 601
  to_add &lt;- A:(A+29)
  to_remove &lt;- c(to_remove, to_add)
  
}</code></pre>
<pre class="r"><code>process_dat &lt;- scraped_data[-to_remove]</code></pre>
<p>We can check that we have reduced our data vector:</p>
<pre class="r"><code>n2 &lt;- length(process_dat)
print(n2)</code></pre>
<pre><code>## [1] 13681</code></pre>
<pre class="r"><code>my_index &lt;- seq(from = 31, to = n2, by = 30)

#Initialize data frame...
my_data &lt;- data.frame(matrix(ncol = 30, nrow = 452))
# Note the dimensions here are found by looking at the table on basketball-
# reference.


# Loop to add each row to the data frame
for (i in 1:length(my_index)){
  current_ind &lt;- my_index[i]
  my_data[i,] &lt;- process_dat[current_ind:(current_ind+30)]
}


colnames(my_data) &lt;- my_variable_names</code></pre>
<pre class="r"><code>str(my_data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    456 obs. of  30 variables:
##  $ Rk              : chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ Player          : chr  &quot;Steven Adams&quot; &quot;Bam Adebayo&quot; &quot;LaMarcus Aldridge&quot; &quot;Nickeil Alexander-Walker&quot; ...
##  $ Pos             : chr  &quot;C&quot; &quot;C&quot; &quot;C&quot; &quot;SG&quot; ...
##  $ Age             : chr  &quot;26&quot; &quot;22&quot; &quot;34&quot; &quot;21&quot; ...
##  $ Tm              : chr  &quot;OKC&quot; &quot;MIA&quot; &quot;SAS&quot; &quot;NOP&quot; ...
##  $ G               : chr  &quot;14&quot; &quot;17&quot; &quot;19&quot; &quot;16&quot; ...
##  $ GS              : chr  &quot;14&quot; &quot;17&quot; &quot;19&quot; &quot;0&quot; ...
##  $ MP              : chr  &quot;26.3&quot; &quot;32.4&quot; &quot;32.9&quot; &quot;14.4&quot; ...
##  $ FG              : chr  &quot;4.0&quot; &quot;5.2&quot; &quot;7.8&quot; &quot;2.3&quot; ...
##  $ FGA             : chr  &quot;7.1&quot; &quot;8.7&quot; &quot;14.9&quot; &quot;7.0&quot; ...
##  $ FG%             : chr  &quot;.560&quot; &quot;.601&quot; &quot;.523&quot; &quot;.321&quot; ...
##  $ Threes_made     : chr  &quot;0.0&quot; &quot;0.1&quot; &quot;0.6&quot; &quot;1.3&quot; ...
##  $ Threes_attempted: chr  &quot;0.0&quot; &quot;0.4&quot; &quot;1.6&quot; &quot;3.8&quot; ...
##  $ Threes_percent  : chr  &quot;&quot; &quot;.167&quot; &quot;.367&quot; &quot;.344&quot; ...
##  $ Twos_made       : chr  &quot;4.0&quot; &quot;5.2&quot; &quot;7.2&quot; &quot;0.9&quot; ...
##  $ Twos_attempted  : chr  &quot;7.1&quot; &quot;8.4&quot; &quot;13.3&quot; &quot;3.2&quot; ...
##  $ Twos_percent    : chr  &quot;.560&quot; &quot;.620&quot; &quot;.542&quot; &quot;.294&quot; ...
##  $ eFG%            : chr  &quot;.560&quot; &quot;.605&quot; &quot;.542&quot; &quot;.415&quot; ...
##  $ FT              : chr  &quot;1.0&quot; &quot;3.9&quot; &quot;2.8&quot; &quot;0.6&quot; ...
##  $ FTA             : chr  &quot;2.5&quot; &quot;6.1&quot; &quot;3.4&quot; &quot;0.9&quot; ...
##  $ FT%             : chr  &quot;.400&quot; &quot;.650&quot; &quot;.828&quot; &quot;.714&quot; ...
##  $ ORB             : chr  &quot;2.7&quot; &quot;2.2&quot; &quot;2.1&quot; &quot;0.1&quot; ...
##  $ DRB             : chr  &quot;6.0&quot; &quot;8.1&quot; &quot;4.5&quot; &quot;2.1&quot; ...
##  $ TRB             : chr  &quot;8.7&quot; &quot;10.4&quot; &quot;6.6&quot; &quot;2.3&quot; ...
##  $ AST             : chr  &quot;2.9&quot; &quot;4.5&quot; &quot;2.3&quot; &quot;2.3&quot; ...
##  $ STL             : chr  &quot;0.4&quot; &quot;1.6&quot; &quot;0.6&quot; &quot;0.3&quot; ...
##  $ BLK             : chr  &quot;0.8&quot; &quot;1.2&quot; &quot;1.7&quot; &quot;0.1&quot; ...
##  $ TOV             : chr  &quot;1.5&quot; &quot;2.8&quot; &quot;1.7&quot; &quot;1.3&quot; ...
##  $ PF              : chr  &quot;1.8&quot; &quot;2.5&quot; &quot;2.2&quot; &quot;1.6&quot; ...
##  $ PTS             : chr  &quot;9.0&quot; &quot;14.5&quot; &quot;18.9&quot; &quot;6.4&quot; ...</code></pre>
<pre class="r"><code>my_data[, c(4, 6:30)] &lt;- sapply(my_data[, c(4,6:30)], as.numeric)
str(my_data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    456 obs. of  30 variables:
##  $ Rk              : chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ Player          : chr  &quot;Steven Adams&quot; &quot;Bam Adebayo&quot; &quot;LaMarcus Aldridge&quot; &quot;Nickeil Alexander-Walker&quot; ...
##  $ Pos             : chr  &quot;C&quot; &quot;C&quot; &quot;C&quot; &quot;SG&quot; ...
##  $ Age             : num  26 22 34 21 24 21 29 26 31 25 ...
##  $ Tm              : chr  &quot;OKC&quot; &quot;MIA&quot; &quot;SAS&quot; &quot;NOP&quot; ...
##  $ G               : num  14 17 19 16 7 18 17 16 2 18 ...
##  $ GS              : num  14 17 19 0 0 15 2 0 0 18 ...
##  $ MP              : num  26.3 32.4 32.9 14.4 16.4 26.6 21.3 20.9 7 33.1 ...
##  $ FG              : num  4 5.2 7.8 2.3 2 4.6 1.4 2.9 1 11.4 ...
##  $ FGA             : num  7.1 8.7 14.9 7 6.6 6.7 4.6 5.7 3.5 20.3 ...
##  $ FG%             : num  0.56 0.601 0.523 0.321 0.304 0.683 0.291 0.516 0.286 0.56 ...
##  $ Threes_made     : num  0 0.1 0.6 1.3 0.7 0 0.5 0.3 0.5 1.4 ...
##  $ Threes_attempted: num  0 0.4 1.6 3.8 3.1 0.1 1.9 1 2.5 4.7 ...
##  $ Threes_percent  : num  NA 0.167 0.367 0.344 0.227 0 0.242 0.25 0.2 0.294 ...
##  $ Twos_made       : num  4 5.2 7.2 0.9 1.3 4.6 0.9 2.7 0.5 10 ...
##  $ Twos_attempted  : num  7.1 8.4 13.3 3.2 3.4 6.6 2.7 4.7 1 15.6 ...
##  $ Twos_percent    : num  0.56 0.62 0.542 0.294 0.375 0.689 0.326 0.573 0.5 0.641 ...
##  $ eFG%            : num  0.56 0.605 0.542 0.415 0.359 0.683 0.342 0.538 0.357 0.594 ...
##  $ FT              : num  1 3.9 2.8 0.6 1.4 2.7 1.1 1 0 6.9 ...
##  $ FTA             : num  2.5 6.1 3.4 0.9 1.7 4.7 1.7 1.8 0 11.7 ...
##  $ FT%             : num  0.4 0.65 0.828 0.714 0.833 0.583 0.655 0.571 NA 0.588 ...
##  $ ORB             : num  2.7 2.2 2.1 0.1 0.1 3.4 1.4 0.9 0 2.7 ...
##  $ DRB             : num  6 8.1 4.5 2.1 2.3 6.9 3.6 3.6 3.5 11 ...
##  $ TRB             : num  8.7 10.4 6.6 2.3 2.4 10.3 5 4.6 3.5 13.7 ...
##  $ AST             : num  2.9 4.5 2.3 2.3 1.9 1.1 1.2 2.6 1 6.2 ...
##  $ STL             : num  0.4 1.6 0.6 0.3 0.3 0.7 0.9 0.8 0.5 1.5 ...
##  $ BLK             : num  0.8 1.2 1.7 0.1 0 1.3 0.5 0.8 0 1.4 ...
##  $ TOV             : num  1.5 2.8 1.7 1.3 1.3 1.2 0.9 0.9 0.5 4.3 ...
##  $ PF              : num  1.8 2.5 2.2 1.6 1.7 2.4 1.6 1.8 0.5 3.6 ...
##  $ PTS             : num  9 14.5 18.9 6.4 6.1 11.8 4.3 7.1 2.5 31.1 ...</code></pre>
<pre class="r"><code>my_data &lt;- as_tibble(my_data)</code></pre>
<pre class="r"><code>my_data &lt;- my_data %&gt;%
  mutate(FP = -0.2*MP - 0.5*FGA + 
           0.75*Threes_made + PTS +
           1.5*ORB + DRB + 1.5*AST +
           2.5*STL + 2.5*BLK - TOV)</code></pre>
<pre class="r"><code>my_data %&gt;%
  select(Player, Tm, FP) %&gt;%
  arrange(desc(FP))</code></pre>
<pre><code>## # A tibble: 456 x 3
##    Player                Tm       FP
##    &lt;chr&gt;                 &lt;chr&gt; &lt;dbl&gt;
##  1 Giannis Antetokounmpo MIL    42.7
##  2 Luka Dončić           DAL    40.3
##  3 James Harden          HOU    40.0
##  4 Karl-Anthony Towns    MIN    37.1
##  5 LeBron James          LAL    35.8
##  6 Anthony Davis         LAL    34.6
##  7 Andre Drummond        DET    32.3
##  8 Kyrie Irving          BRK    30.6
##  9 Damian Lillard        POR    30.4
## 10 Kawhi Leonard         LAC    30.4
## # … with 446 more rows</code></pre>
<pre class="r"><code>my_data %&gt;%
  filter(Player ==&quot;Kendrick Nunn&quot;) %&gt;%
  arrange(desc(FP)) %&gt;%
  View()</code></pre>
</div>
